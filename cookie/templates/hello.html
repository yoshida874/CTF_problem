<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>{{ title }}</title>
</head>

<body>
    {% block content %}
    <h1>Hello {{ name }}さん! </h1>
    {{ flag }}
    <form method="POST">
        <input type="text" name="name">
        <button type="submit">submit</button>
    </form>

    <h1>src</h1>
    <pre>
    <code>
    from flask import Flask,request,render_template,make_response,escape
    from datetime import datetime
    import os

    app = Flask(__name__)

    @app.route('/',methods=['GET','POST'])
    def hello():
        name = 'HOGE'
        cookie_name = ''

        if request.method == 'POST':
            cookie_name = escape(request.form['name'])
            name = escape(request.form['name'])
            if name == 'admin':
                name = 'not admin'

            flag = get_flag(name)
            response = make_response(render_template("hello.html", title='CTF2', name=name, flag=flag)) 
            max_age = 10
            expires = int(datetime.now().timestamp()) + max_age
            response.set_cookie('name', value=cookie_name, max_age=max_age, expires=expires, path='/', secure=None, httponly=False)
            
        else:
            name = request.cookies.get('name', None)
            flag = get_flag(name)
            response = make_response(render_template("hello.html", title='CTF2', name=name, flag=flag)) 

        return response


    def get_flag(name):
        if name == 'admin':
            flag = 'wizCTF{************}'
        else:
            flag = 'adminだけがFlagを見ることができます'

        return flag

    </code>
    </pre>
    {% endblock %}
</body>

</html>